# Nmap 网络扫描管理控制程序（MCP）规范文档

## 一、服务介绍

本服务是一款基于`nmap`工具封装实现的网络扫描管理控制程序（MCP），核心功能为对本地或远程服务器的**IP/网段进行主机发现、端口探测、服务识别**，支持多模式扫描与自定义配置，自动解析扫描结果并输出结构化数据，为网络设备 inventory 管理、端口安全检测、网络拓扑梳理提供标准化工具支撑，适配中小型企业网络或测试环境的自动化扫描需求。

## 二、核心工具信息

|工具名称|工具功能|核心输入参数|关键返回内容|
|---|---|---|---|
|`scan_network`|本地/远程主机的IP/网段扫描（支持主机发现、端口探测、服务识别）|- `target`：扫描目标（必填，支持单个IP、CIDR网段、IP范围，如[192.168.1.1](192.168.1.1)、[192.168.1.0/24](192.168.1.0/24)、[192.168.1.1](192.168.1.1)-100）<br>- `scan_type`：扫描类型（可选，basic/full/quick，默认basic；basic=常用100端口，full=1-65535全端口，quick=10个核心端口）<br>- `port_range`：自定义端口范围（可选，如22,80-443，优先级高于scan_type）<br>- `host_discovery`：是否仅主机发现（不扫描端口，True/False，默认False）<br>- `host`：远程主机名/IP（默认[localhost](http://localhost)，本地操作可不填）<br>- `ssh_port`：SSH端口（默认22，远程操作时使用）<br>- `ssh_user`：SSH用户名（远程操作必填）<br>- `ssh_pwd`：SSH密码（远程操作可选，与ssh_key二选一）<br>- `ssh_key`：SSH私钥路径（远程操作可选，优先于密码）|- `success`：操作是否成功（布尔值）<br>- `message`：操作结果描述（如"成功扫描[192.168.1.0/24](192.168.1.0/24)，发现8台活跃主机"）<br>- `data`：包含扫描结果的字典<br>  - `host`：执行扫描的主机名/IP<br>  - `target`：扫描目标<br>  - `scan_type`：扫描类型（含custom，即自定义端口）<br>  - `host_count`：发现的主机总数<br>  - `up_host_count`：活跃主机数量<br>  - `results`：主机列表，每个主机包含：<br>    - `ip`：主机IP<br>    - `status`：状态（up/down/unknown）<br>    - `status_details`：状态详情（如延迟时间）<br>    - `open_ports`：开放端口列表（含端口号、状态、服务名、详情）|
## 三、工具使用说明

1. **本地操作规则**：不填写`host`、`ssh_user`、`ssh_pwd`、`ssh_key`参数，默认对本机（`localhost`）发起扫描；仅需提供`target`核心参数，`scan_type`/`port_range`/`host_discovery`根据需求选择配置（如仅主机发现需设`host_discovery=True`）。

2. **远程操作规则**：必须提供`host`（远程主机IP/hostname）、`ssh_user`（SSH用户名），以及`ssh_pwd`或`ssh_key`（二选一）；`ssh_port`可选（默认22）；需确保远程主机已安装`nmap`工具，且SSH用户具备`nmap`执行权限（推荐root用户，避免特权端口扫描受限）。

3. **权限要求**：  

    - 本地操作：扫描特权端口（1-1024）需root或sudo权限，普通用户仅能扫描1024以上端口；建议以root用户运行或配置`sudo nmap`免密。  

    - 远程操作：SSH用户需对`nmap`工具及扫描目标网络有访问权限，若扫描远程网段，需确保远程主机与目标网段网络互通。

## 四、注意事项

- **目标格式有效性**：`target`需符合IP（如[192.168.1.1](192.168.1.1)）、CIDR（如[192.168.1.0/24](192.168.1.0/24)）、IP范围（如[192.168.1.1](192.168.1.1)-100）格式，工具会自动校验，无效格式会返回明确错误提示。

- **扫描模式优先级**：`port_range`（自定义端口）优先级高于`scan_type`（预设模式），若同时配置，仅按`port_range`扫描。

- **扫描效率与耗时**：全端口扫描（`scan_type="full"`）单IP耗时约1-5分钟，大规模网段（如/16）需1小时以上，建议结合`host_discovery`先筛选活跃主机再针对性扫描。

- **网络安全合规**：扫描公网IP或非授权网络可能违反《网络安全法》或企业安全政策，需确保扫描目标为自有或已获授权的设备/网段。

- **工具依赖性**：所有操作依赖目标主机已安装`nmap`（7.80+版本），未安装会返回"nmap: command not found"错误，Linux需通过`apt/yum install nmap`安装，Windows需手动安装并配置环境变量。

- **防火墙拦截风险**：部分设备防火墙会拦截`nmap`扫描包（如ICMP禁ping、端口过滤），可能导致“主机down”或“端口状态未知”，需提前开放扫描所需协议（TCP/UDP/ICMP）。