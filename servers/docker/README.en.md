# Docker MCP Tool User Guide
# Docker Container Management MCP (Management and Control Program) Specification Document

## 1. Service Introduction
This service is a container full-lifecycle management and control program (MCP) implemented based on Docker CLI encapsulation. Its core functions include **container creation/startup/shutdown/deletion, image pulling/pushing/tag management, volume and network configuration, container log query, and command interaction** for local or remote servers. It supports filtering by container name, image version, port mapping, etc., enabling rapid deployment, operation, maintenance, and fault location of containerized applications, and providing standardized tool support for DevOps processes and system operation and maintenance.

## 2. Core Tool Information

| Tool Name               | Tool Function                                                                 | Core Input Parameters                                                                                                                                                                                                 | Key Return Content                                                                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `manage_container`      | Full-lifecycle management of containers on local/remote hosts (create/start/stop/delete/restart, supporting port and volume configuration)                                                                 | - `name`: Container name (required, unique identifier for the container)<br>- `image`: Image name (required for creation, e.g., nginx:latest)<br>- `action`: Operation type (create/start/stop/delete/restart, required)<br>- `ports`: Port mapping (optional, format "8080:80,443:443")<br>- `volumes`: Volume mounting (optional, format "/host/path:/container/path:ro")<br>- `restart_policy`: Restart policy (no/always/on-failure/unless-stopped, default: no)<br>- `host`: Remote host name/IP (default: localhost)<br>- `ssh_port`: SSH port (default: 22, used for remote operations) | - `success`: Whether the operation is successful (boolean)<br>- `message`: Operation result description (e.g., "Container my-nginx started successfully")<br>- `data`: Dictionary containing container operation information<br>  - `host`: Host name/IP of the operation<br>  - `container_name`: Container name<br>  - `action`: Type of operation performed<br>  - `details`: Operation details (e.g., container ID, configuration parameters) |
| `manage_image`          | Image management on local/remote hosts (pull/delete/tag/push, supporting private registry authentication)                                                                 | - `image`: Image name (required, e.g., nginx:latest, registry.com/app:v1)<br>- `action`: Operation type (pull/delete/tag/push/inspect, required)<br>- `new_tag`: New tag (required for tag operation, format "my-app:v1")<br>- `registry_auth`: Registry authentication (optional, format "username:password", used for private registries)<br>- `host`: Remote host name/IP (default: localhost)<br>- `ssh_port`: SSH port (default: 22, used for remote operations) | - `success`: Whether the operation is successful (boolean)<br>- `message`: Operation result description (e.g., "Image nginx:latest pulled successfully")<br>- `data`: Dictionary containing image information<br>  - `host`: Host name/IP of the operation<br>  - `image`: Image name<br>  - `action`: Type of operation performed<br>  - `inspect`: Image details (returned by inspect operation, including architecture, configuration, etc.) |
| `container_data_operate`| Container data interaction on local/remote hosts (container import/export, file copy between container and local)                                                                 | - `name`: Container name (required; image prefix for import operation)<br>- `action`: Operation type (export/import/cp, required)<br>- `file_path`: File path (required; format "src:dst" for cp operation)<br>- `host`: Remote host name/IP (default: localhost)<br>- `ssh_port`: SSH port (default: 22, used for remote operations) | - `success`: Whether the operation is successful (boolean)<br>- `message`: Operation result description (e.g., "Container my-nginx exported successfully")<br>- `data`: Dictionary containing data operation information<br>  - `host`: Host name/IP of the operation<br>  - `container_name`: Container name<br>  - `action`: Type of operation performed<br>  - `file_path`: File path of the operation |
| `container_logs`        | Container log query on local/remote hosts (supporting real-time tracking, time and line count filtering)                                                                 | - `name`: Container name (required)<br>- `tail`: Number of log lines (default: 100; 0 means all)<br>- `follow`: Real-time tracking (True/False, default: False)<br>- `since`: Time filter (optional, format "10m"/"2024-01-01T00:00:00")<br>- `host`: Remote host name/IP (default: localhost)<br>- `ssh_port`: SSH port (default: 22, used for remote operations) | - `success`: Whether the operation is successful (boolean)<br>- `message`: Operation result description (e.g., "Successfully obtained logs of my-nginx")<br>- `data`: Dictionary containing log information<br>  - `host`: Host name/IP of the operation<br>  - `container_name`: Container name<br>  - `logs`: Log content (string format)<br>  - `filter`: Filter conditions (tail/since) |
| `list_containers`       | Container list query on local/remote hosts (supporting filtering by running status, name/image)                                                                 | - `all`: Show all containers (True/False, default: False, only show running ones)<br>- `filter`: Filter conditions (optional, format "name=nginx,image=nginx:latest")<br>- `host`: Remote host name/IP (default: localhost)<br>- `ssh_port`: SSH port (default: 22, used for remote operations) | - `success`: Whether the operation is successful (boolean)<br>- `message`: Operation result description (e.g., "Successfully obtained 5 running containers locally")<br>- `data`: Dictionary containing container list<br>  - `host`: Host name/IP of the operation<br>  - `container_count`: Total number of containers<br>  - `containers`: Container list (including ID, name, image, status, etc.)<br>  - `filter`: Filter conditions (all/name/image) |

## 3. Tool User Guide

1. **Pre-dependencies**: The target host must have Docker installed (version 19.03+) and the service started. For local operations, the executing user must be added to the `docker` group or have `sudo` privileges; for remote operations, the target host must have the SSH service enabled, and the SSH user must have Docker operation privileges (authorized via `usermod -aG docker username`).

2. **Local Operation Process**: ① Container deployment: Call `manage_container` with `action=create`, `name=my-nginx`, `image=nginx:latest`, and `ports=8080:80`, then execute `action=start` to start the container; ② Image management: Call `manage_image` with `action=pull` to pull an image, `action=tag` to add a tag, and supplement `registry_auth` for private images; ③ Log query: Call `container_logs` with `name=my-nginx` and `tail=50` to view the latest 50 log lines, or set `follow=True` to enable real-time tracking.

3. **Remote Operation Process**: ① Configuration preparation: Add the target host (including host, name, port, username, password) to `remote_hosts` in `DockerConfig`; ② Remote execution: Pass `host=remote IP/alias` when calling the tool, e.g., `list_containers(host=prod-server, all=True)` to query all containers on the remote host; ③ Port override: If the remote SSH port is not 22, supplement the `ssh_port=2222` parameter (e.g., `manage_container(name=my-app, action=restart, host=prod-server, ssh_port=2222)`).

## 4. Notes

- **Uniqueness of Container Names**: The `name` parameter cannot be duplicated on the same host. Duplicate creation will return a "Container already exists" error, and you need to perform the `delete` operation first or use a different name.

- **Image Format Specification**: The `image` parameter must include the name and tag (e.g., ubuntu:20.04). If no tag is specified, the `latest` version will be pulled by default. Private images must include the registry address (e.g., registry.com/app:v1).

- **Volume Permissions**: When mounting a local directory via `volumes`, ensure the local directory exists and has correct permissions (the user inside the container must have read/write permissions, which can be adjusted via `chmod 755 /host/path`).

- **Private Registry Security**: The `registry_auth` parameter requires "username:password" format. In production environments, it is recommended to store it encrypted via configuration files to avoid plaintext hardcoding.

- **Real-time Log Timeout**: When `follow=True`, the tool has a default 10-second timeout to avoid long-term process blocking. For continuous tracking, you need to call it in a loop in the code.

- **Large Image Operations**: When pulling/pushing images larger than GB level, you can adjust the timeout parameter (default: 60 seconds) in `execute_local_command`/`execute_remote_command` to prevent timeout failures.

